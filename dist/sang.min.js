!function(){"use strict";angular.module("audio",[]).config(["$provide",function($provide){$provide.factory("Audio",function(){var audio=global.audio||document.createElement("audio");return audio})}]),angular.module("sang",["audio"]).config(["$provide",function($provide){$provide.factory("Sang",["Audio","$http","$timeout",function(Audio,$http,$timeout){var sang={clientId:"",resolve:function(playlistUrl){var self=this;$http.get("https://api.soundcloud.com/resolve",{params:{client_id:this.clientId,url:playlistUrl}}).then(function(response){self.tracks=self.mapTracks(response.data.tracks)})},mapTracks:function(tracks){var self=this;return tracks.map(function(track){var src=track.stream_url,separator=-1===src.indexOf("?")?"?":"&";return track.src=src+separator+"client_id="+self.clientId,track})},audio:Audio,currentTrack:{},currentTime:0,duration:0,tracks:[],index:0,playing:!1,play:function(idx){"number"==typeof idx&&this.tracks.length&&(this.index=idx%this.tracks.length,this.currentTrack=this.tracks[this.index]),this.playing=!0,this.audio.src=this.currentTrack.src,this.audio.play()},pause:function(){this.playing=!1,this.audio.pause()},playPause:function(idx){this.playing?this.pause():this.play(idx)},previous:function(){this.index--,this.playing&&this.play(this.index)},next:function(){this.index++,this.playing&&this.play(this.index)},seek:function(e){if(!this.audio.readyState)return!1;var percent=e.offsetX/e.target.offsetWidth||(e.layerX-e.target.offsetLeft)/e.target.offsetWidth,time=percent*this.audio.duration||0;this.audio.currentTime=time}};return sang.audio.addEventListener("timeupdate",function(){}),sang.audio.addEventListener("ended",function(){sang.next()}),sang}])}])}(),function(){"use strict";angular.module("sang").directive("sangPlayer",["Sang",function(SangService){return{restrict:"EA",scope:!1,link:function(scope,_elem,attr){scope.sang=SangService}}}])}();
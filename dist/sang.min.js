!function(){"use strict";angular.module("audio",[]).config(["$provide",function($provide){$provide.factory("Audio",function(){var audio=window.audio||document.createElement("audio");return audio})}]),angular.module("sang",["audio"]).config(["$provide",function($provide){$provide.factory("Sang",["Audio","$http","$timeout","$rootScope",function(Audio,$http,$timeout,$rootScope){var sang={clientId:"",resolve:function(playlistUrl){var self=this;$http.get("https://api.soundcloud.com/resolve",{params:{client_id:this.clientId,url:playlistUrl}}).then(function(response){self.tracks=self.mapTracks(response.data.tracks),self.currentTrack=self.tracks[0],$rootScope.$broadcast("resolved")})},mapTracks:function(tracks){var self=this;return tracks.map(function(track){var src=track.stream_url,separator=src.indexOf("?")===-1?"?":"&";return track.src=src+separator+"client_id="+self.clientId,track})},audio:Audio,tracks:[],currentTrack:{},currentTime:0,duration:0,index:0,playing:!1,play:function(idx){"number"==typeof idx&&this.tracks.length&&(this.index=idx%this.tracks.length,this.currentTrack=this.tracks[this.index]),this.playing=!0,this.audio.src!==this.currentTrack.src&&(this.audio.src=this.currentTrack.src),this.audio.play(),this.duration=this.audio.duration,this.currentTime=this.audio.currentTime},pause:function(){this.playing=!1,this.audio.pause()},playPause:function(idx){this.playing?this.pause():this.play(idx)},previous:function(){this.index--,this.playing&&this.play(this.index)},next:function(){this.index++,this.playing&&this.play(this.index)},seek:function(e){if(!this.audio.readyState)return!1;var percent=e.offsetX/e.target.offsetWidth||(e.layerX-e.target.offsetLeft)/e.target.offsetWidth,time=percent*this.audio.duration||0;this.audio.currentTime=time}};return sang.audio.addEventListener("timeupdate",function(event){sang.currentTime=event.target.currentTime,$rootScope.$broadcast("timeupdate",sang.currentTime)}),sang.audio.addEventListener("ended",function(){sang.next()}),sang}])}])}(),function(){"use strict";angular.module("sang").directive("sangPlayer",["Sang",function(Sang){return{restrict:"EA",scope:!1,link:function(scope,_elem,attr){var sang=Sang;sang.clientId=attr.clientId,sang.url=attr.url,attr.clientId&&attr.url&&sang.resolve(attr.url),scope.$on("timeupdate",function(event,currentTime){console.log(currentTime),scope.$apply()}),scope.sang=sang}}}])}();